<!DOCTYPE html>
<html>

<body>
    <h3>è¿·è·¯ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆã‚¿ãƒ¼ãƒ³åˆ¶ãƒ»é›£æ˜“åº¦è©•ä¾¡ç”¨ï¼‰</h3>
    <p>â† â†‘ â†’ â†“ ã‚­ãƒ¼ã§æ“ä½œï¼ˆ1å…¥åŠ›ï¼1ã‚¿ãƒ¼ãƒ³ï¼‰</p>
    <pre id="screen"></pre>
    <p id="difficulty"></p>

    <script>
        // åˆæœŸãƒãƒƒãƒ—
        const baseMap = [
            [1, 1, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 1, 0, 0, 1],
            [1, 0, 1, 0, 1, 0, 1, 1],
            [1, 0, 1, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 1, 1, 0, 1],
            [1, 1, 1, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1],
        ];

        let map;
        let px, py;
        let ex, ey;

        const MAX_DISTANCE = 14;

        const screen = document.getElementById("screen");
        const diffView = document.getElementById("difficulty");

        function resetGame() {
            map = baseMap.map(row => [...row]);
            px = 1; py = 1;
            ex = 6; ey = 5;
            draw();
            updateDifficulty();
        }

        function draw() {
            let out = "";
            for (let y = 0; y < map.length; y++) {
                for (let x = 0; x < map[y].length; x++) {
                    if (x === px && y === py) out += "P";
                    else if (x === ex && y === ey) out += "E";
                    else if (map[y][x] === 1) out += "â– ";
                    else if (map[y][x] === 0) out += "ãƒ»";
                    else out += " ";
                }
                out += "\n";
            }
            screen.textContent = out;
        }

        function canMove(x, y) {
            return map[y][x] !== 1;
        }

        function distance() {
            return Math.abs(px - ex) + Math.abs(py - ey);
        }

        function calcDifficulty() {
            const pressureScore = MAX_DISTANCE - distance();
            return Math.max(0, pressureScore);
        }

        function updateDifficulty() {
            diffView.textContent = `é›£æ˜“åº¦ã‚¹ã‚³ã‚¢ï¼š${calcDifficulty()}`;
        }

        function gameOver() {
            alert("ğŸ‘» GAME OVER");
            resetGame();
        }

        function checkClear() {
            for (let y = 0; y < map.length; y++) {
                if (map[y].includes(0)) return;
            }
            alert("ğŸ‰ ã‚¯ãƒªã‚¢ï¼");
            resetGame();
        }

        function moveEnemy() {
            let dx = 0, dy = 0;

            if (Math.abs(px - ex) > Math.abs(py - ey)) {
                dx = px > ex ? 1 : -1;
            } else {
                dy = py > ey ? 1 : -1;
            }

            const nx = ex + dx;
            const ny = ey + dy;

            if (canMove(nx, ny)) {
                ex = nx;
                ey = ny;
            }
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ“ä½œï¼ˆï¼1ã‚¿ãƒ¼ãƒ³ï¼‰
        document.addEventListener("keydown", e => {
            let nx = px, ny = py;

            if (e.key === "ArrowUp") ny--;
            if (e.key === "ArrowDown") ny++;
            if (e.key === "ArrowLeft") nx--;
            if (e.key === "ArrowRight") nx++;

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹•
            if (canMove(nx, ny)) {
                px = nx;
                py = ny;
                if (map[py][px] === 0) map[py][px] = 2;
            }

            // æ•µã‚‚1å›å‹•ã
            moveEnemy();

            // åˆ¤å®š
            if (px === ex && py === ey) {
                gameOver();
                return;
            }

            checkClear();
            draw();
            updateDifficulty();
        });

        resetGame();
    </script>
</body>

</html>