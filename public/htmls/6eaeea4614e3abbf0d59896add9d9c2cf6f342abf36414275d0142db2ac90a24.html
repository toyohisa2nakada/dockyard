<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>AI Janken Prototype</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            background: #f0f0f0;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .hands {
            font-size: 50px;
            margin: 20px;
        }

        button {
            font-size: 30px;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: #ddd;
            transition: 0.2s;
        }

        button:hover {
            background: #bbb;
            transform: scale(1.1);
        }

        #result {
            font-size: 24px;
            font-weight: bold;
            margin: 20px;
            height: 30px;
        }

        #stats {
            font-size: 14px;
            color: #555;
            text-align: left;
            background: #eee;
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            font-family: monospace;
        }

        .bar-container {
            width: 100%;
            background: #ccc;
            height: 10px;
            border-radius: 5px;
            margin-bottom: 5px;
            overflow: hidden;
        }

        .bar {
            height: 100%;
            background: #4caf50;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>ğŸ§  æ€è€ƒã‚’èª­ã‚€ã˜ã‚ƒã‚“ã‘ã‚“AI</h2>
        <p>ã‚ãªãŸã®ã‚¯ã‚»ã‚’å­¦ç¿’ã—ã¦ã€æ¬¡ã®ä¸€æ‰‹ã‚’äºˆæ¸¬ã—ã¾ã™ã€‚<br>æœ€åˆã¯å¼±ã„ã§ã™ãŒã€10å›ã»ã©æˆ¦ã†ã¨å¼·ããªã‚Šã¾ã™ã€‚</p>
        <div id="result">æº–å‚™å®Œäº†ï¼æ‰‹ã‚’é¸ã‚“ã§ãã ã•ã„</div>
        <div class="hands">
            <div id="ai-hand">ğŸ¤– AI: ???</div>
            <div id="human-hand">ğŸ‘¤ ã‚ãªãŸ: ???</div>
        </div>
        <div> <button onclick="play(0)">âœŠ ã‚°ãƒ¼</button> <button onclick="play(1)">âœŒï¸ ãƒãƒ§ã‚­</button> <button
                onclick="play(2)">âœ‹ ãƒ‘ãƒ¼</button>
        </div>
        <div id="stats">
            <p><strong>AIã®è„³å†… (äºˆæ¸¬ç¢ºç‡):</strong></p> ã‚°ãƒ¼ãŒæ¥ã‚‹ç¢ºç‡: <div class="bar-container">
                <div id="prob0" class="bar" style="background:#ff5252"></div>
            </div> ãƒãƒ§ã‚­ãŒæ¥ã‚‹ç¢ºç‡: <div class="bar-container">
                <div id="prob1" class="bar" style="background:#448aff"></div>
            </div> ãƒ‘ãƒ¼ãŒæ¥ã‚‹ç¢ºç‡: <div class="bar-container">
                <div id="prob2" class="bar" style="background:#69f0ae"></div>
            </div>
            <p>å¯¾æˆ¦æ•°: <span id="round">0</span> | AIã®å‹ç‡: <span id="winrate">0</span>%</p>
        </div>
    </div>
    <script> /** * ç°¡æ˜“FNN (Feedforward Neural Network) ã‚¯ãƒ©ã‚¹ * ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã‚ãšã€JavaScriptã®æ¨™æº–æ©Ÿèƒ½ã ã‘ã§å®Ÿè£… */
        class SimpleFNN {
            constructor(inputNodes, hiddenNodes, outputNodes) {
                this.inputNodes = inputNodes; this.hiddenNodes = hiddenNodes; this.outputNodes = outputNodes; this.learningRate = 0.1; // å­¦ç¿’ç‡ // é‡ã¿ã®åˆæœŸåŒ–ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰ 
                this.weights_ih = this.createMatrix(this.hiddenNodes, this.inputNodes);
                // å…¥åŠ›â†’éš ã‚Œ 
                this.weights_ho = this.createMatrix(this.outputNodes, this.hiddenNodes);
                // éš ã‚Œâ†’å‡ºåŠ› 
            }
            createMatrix(rows, cols) { return Array.from({ length: rows }, () => Array.from({ length: cols }, () => Math.random() * 2 - 1)); }
            // ã‚·ã‚°ãƒ¢ã‚¤ãƒ‰é–¢æ•°ï¼ˆæ´»æ€§åŒ–é–¢æ•°ï¼‰ 
            sigmoid(x) { return 1 / (1 + Math.exp(-x)); }
            // ã‚·ã‚°ãƒ¢ã‚¤ãƒ‰ã®å¾®åˆ†ï¼ˆå­¦ç¿’ç”¨ï¼‰ 
            dsigmoid(y) { return y * (1 - y); }
            // æ¨è«–ï¼ˆäºˆæ¸¬ï¼‰ã‚’è¡Œã†ãƒ¡ã‚½ãƒƒãƒ‰ 
            predict(inputArray) {
                // 1. éš ã‚Œå±¤ã®è¨ˆç®— 
                let hidden = this.multiply(this.weights_ih, inputArray); hidden = hidden.map(val => this.sigmoid(val));
                // 2. å‡ºåŠ›å±¤ã®è¨ˆç®— 
                let output = this.multiply(this.weights_ho, hidden); output = output.map(val => this.sigmoid(val)); return { output, hidden };
            }
            // å­¦ç¿’ï¼ˆãƒãƒƒã‚¯ãƒ—ãƒ­ãƒ‘ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã‚’è¡Œã†ãƒ¡ã‚½ãƒƒãƒ‰ 
            train(inputArray, targetArray) {
                // ã¾ãšç¾åœ¨ã®äºˆæ¸¬ã‚’è¡Œã† 
                let { output, hidden } = this.predict(inputArray);
                // --- èª¤å·®é€†ä¼æ’­æ³• --- 
                // 1. å‡ºåŠ›å±¤ã®èª¤å·®ï¼ˆæ­£è§£ - äºˆæ¸¬ï¼‰ 
                let outputErrors = targetArray.map((t, i) => t - output[i]);
                // 2. éš ã‚Œå±¤â†’å‡ºåŠ›å±¤ã®é‡ã¿æ›´æ–° 
                let outputGradients = output.map((o, i) => this.dsigmoid(o) * outputErrors[i] * this.learningRate);
                // è¡Œåˆ—æ¼”ç®—ã®ç°¡æ˜“å®Ÿè£…ï¼ˆé‡ã¿ã®æ›´æ–°ï¼‰ 
                for (let i = 0; i < this.outputNodes; i++) { for (let j = 0; j < this.hiddenNodes; j++) { this.weights_ho[i][j] += outputGradients[i] * hidden[j]; } }
                // 3. éš ã‚Œå±¤ã®èª¤å·® 
                let hiddenErrors = new Array(this.hiddenNodes).fill(0); for (let i = 0; i < this.outputNodes; i++) { for (let j = 0; j < this.hiddenNodes; j++) { hiddenErrors[j] += this.weights_ho[i][j] * outputErrors[i]; } }
                // 4. å…¥åŠ›å±¤â†’éš ã‚Œå±¤ã®é‡ã¿æ›´æ–° 
                let hiddenGradients = hidden.map((h, i) => this.dsigmoid(h) * hiddenErrors[i] * this.learningRate); for (let i = 0; i < this.hiddenNodes; i++) {
                    for (let j = 0; j < this.inputNodes; j++) { this.weights_ih[i][j] += hiddenGradients[i] * inputArray[j]; }
                }
            }
            // è¡Œåˆ—ã¨ãƒ™ã‚¯ãƒˆãƒ«ã®ç© 
            multiply(matrix, vector) { return matrix.map(row => row.reduce((sum, weight, i) => sum + weight * vector[i], 0)); }
        }
        // --- ã‚²ãƒ¼ãƒ ã®ãƒ­ã‚¸ãƒƒã‚¯ --- 
        // å…¥åŠ›3(å‰ã®æ‰‹:G,C,P) -> éš ã‚Œ4 -> å‡ºåŠ›3(äºˆæ¸¬:G,C,P) 
        const brain = new SimpleFNN(3, 4, 3); let lastHumanMove = null;
        // 1å›å‰ã®äººé–“ã®æ‰‹ 
        let totalGames = 0; let aiWins = 0; function play(humanMove) {
            const hands = ["âœŠ", "âœŒï¸", "âœ‹"];
            // 1. AIã®æ‰‹ã‚’æ±ºã‚ã‚‹ 
            // ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒãªã„(åˆå›)ã¯ãƒ©ãƒ³ãƒ€ãƒ ã€2å›ç›®ä»¥é™ã¯äºˆæ¸¬ã«åŸºã¥ã„ã¦å‹ã¤æ‰‹ã‚’å‡ºã™ 
            let aiPrediction = [0.33, 0.33, 0.33]; let aiMove = Math.floor(Math.random() * 3); if (lastHumanMove !== null) {
                // å‰å›ã®äººé–“æ‰‹ã‚’å…¥åŠ›ã«ã—ã¦ã€ä»Šå›äººé–“ãŒå‡ºã™æ‰‹ã‚’äºˆæ¸¬ 
                let input = [0, 0, 0]; input[lastHumanMove] = 1;
                // One-hot encoding 
                let result = brain.predict(input); aiPrediction = result.output;
                // äºˆæ¸¬ç¢ºç‡ãŒæœ€ã‚‚é«˜ã„æ‰‹ã‚’æ¢ã™ 
                let predictedHumanMove = aiPrediction.indexOf(Math.max(...aiPrediction));
                // ãã®æ‰‹ã«å‹ã¤æ‰‹ã‚’å‡ºã™ (G(0)ã«ã¯P(2), C(1)ã«ã¯G(0), P(2)ã«ã¯C(1))
                aiMove = (predictedHumanMove + 2) % 3;
                // å‹ã¤æ‰‹ã®ãƒ­ã‚¸ãƒƒã‚¯
            }
            // 2. å‹æ•—åˆ¤å®š 
            // (0:G, 1:C, 2:P) -> (Human - AI + 3) % 3 ... 0:ã‚ã„ã“, 1:è² ã‘(AIå‹ã¡), 2:å‹ã¡ 
            let judge = (humanMove - aiMove + 3) % 3; let msg = ""; let color = "black"; if (judge === 0) { msg = "ã‚ã„ã“ï¼"; } else if (judge === 1) { msg = "AIã®å‹ã¡ï¼ï¼ˆäºˆæ¸¬çš„ä¸­ï¼Ÿï¼‰"; color = "red"; aiWins++; } else { msg = "ã‚ãªãŸã®å‹ã¡ï¼"; color = "blue"; } totalGames++;
            // 3. ç”»é¢æ›´æ–° 
            document.getElementById("human-hand").innerText = "ğŸ‘¤ ã‚ãªãŸ: " + hands[humanMove]; document.getElementById("ai-hand").innerText = "ğŸ¤– AI: " + hands[aiMove]; const resDiv = document.getElementById("result"); resDiv.innerText = msg; resDiv.style.color = color; document.getElementById("round").innerText = totalGames; document.getElementById("winrate").innerText = ((aiWins / totalGames) * 100).toFixed(1);
            // AIã®æ€è€ƒï¼ˆäºˆæ¸¬ç¢ºç‡ï¼‰ã®å¯è¦–åŒ– 
            document.getElementById("prob0").style.width = (aiPrediction[0] * 100) + "%"; document.getElementById("prob1").style.width = (aiPrediction[1] * 100) + "%"; document.getElementById("prob2").style.width = (aiPrediction[2] * 100) + "%";
            // 4. å­¦ç¿’ (ã“ã‚ŒãŒä¸€ç•ªé‡è¦ï¼) 
            // ã€Œå‰å›ã®æ‰‹ã€ãŒã‚ã£ãŸå ´åˆã€ä»Šå›ã®çµæœã‚’ä½¿ã£ã¦AIã‚’è³¢ãã™ã‚‹ 
            if (lastHumanMove !== null) {
                let input = [0, 0, 0]; input[lastHumanMove] = 1; let target = [0, 0, 0]; target[humanMove] = 1;
                // ä»Šå›äººé–“ãŒå®Ÿéš›ã«å‡ºã—ãŸæ‰‹ãŒã€Œæ­£è§£ã€ 
                // ãƒãƒƒã‚¯ãƒ—ãƒ­ãƒ‘ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ 
                brain.train(input, target);
            }
            // ä»Šå›ã®æ‰‹ã‚’è¨˜æ†¶ï¼ˆæ¬¡å›ã®å…¥åŠ›ã«ãªã‚‹ï¼‰ 
            lastHumanMove = humanMove;
        }
    </script>
</body>

</html>