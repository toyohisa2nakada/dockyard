<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Board Game - Chance Added</title>
    <style>
        :root {
            --board-bg: #cde6d0;
            --center-bg: #fdfdfd;
            --p1-color: #ff4444;
            --p2-color: #4444ff;
            --house-color: #4CAF50;
            --hotel-color: #f44336;
            --square-size: 32px;
            --board-size: calc(var(--square-size) * 11 + 6px);
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #2c3e50;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #game-container {
            display: flex;
            gap: 6px;
            background: white;
            padding: 6px;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            max-height: 100vh;
            box-sizing: border-box;
            align-items: flex-start;
        }

        /* --- ãƒœãƒ¼ãƒ‰ --- */
        #board-wrapper {
            position: relative;
        }

        #game-board {
            display: grid;
            grid-template-columns: repeat(11, var(--square-size));
            grid-template-rows: repeat(11, var(--square-size));
            gap: 1px;
            background-color: #444;
            border: 1px solid #444;
        }

        .square {
            background-color: #f4f4f4;
            font-size: 4.5px;
            display: flex;
            flex-direction: column;
            position: relative;
            box-sizing: border-box;
            overflow: hidden;
        }

        .square-center {
            grid-column: 2 / 11;
            grid-row: 2 / 11;
            background-color: var(--center-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2px;
            text-align: center;
        }

        .color-bar {
            height: 5px;
            width: 100%;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .square-name {
            font-weight: bold;
            text-align: center;
            margin-top: 0;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 0.9;
            white-space: nowrap;
            letter-spacing: -0.3px;
            overflow: hidden;
        }

        .square-price {
            text-align: center;
            margin-bottom: 0;
            color: #555;
            font-size: 4px;
            line-height: 1;
        }

        /* --- ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿é¡ --- */
        .owner-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
        }

        .house-container {
            position: absolute;
            top: 6px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 1px;
            pointer-events: none;
        }

        .house-icon {
            width: 3px;
            height: 3px;
            background-color: var(--house-color);
            border: 0.5px solid white;
        }

        .house-icon.hotel {
            background-color: var(--hotel-color);
            width: 5px;
            height: 4px;
        }

        /* --- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é§’ --- */
        .token {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            border: 1px solid white;
            box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            position: absolute;
            z-index: 10;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .token.p1 {
            background-color: var(--p1-color);
            top: 40%;
            left: 40%;
        }

        .token.p2 {
            background-color: var(--p2-color);
            top: 40%;
            right: 40%;
        }

        /* --- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« --- */
        #control-panel {
            width: 180px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .player-card {
            padding: 4px 6px;
            border-radius: 3px;
            background: #f0f0f0;
            border-left: 3px solid #ccc;
            transition: all 0.3s;
            position: relative;
        }

        .player-card.active {
            background: #fff;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
            transform: scale(1.01);
        }

        .player-card.p1.active {
            border-left-color: var(--p1-color);
        }

        .player-card.p2.active {
            border-left-color: var(--p2-color);
        }

        .jail-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: #333;
            color: white;
            padding: 0 2px;
            font-size: 6px;
            border-radius: 2px;
            display: none;
        }

        .money-display {
            font-size: 14px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            line-height: 1;
        }

        #action-area {
            background: #e8f4f8;
            padding: 4px;
            border-radius: 3px;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .btn {
            padding: 3px 6px;
            font-size: 10px;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-weight: bold;
            margin: 1px;
            transition: background 0.2s;
        }

        .btn-roll {
            background-color: #27ae60;
            color: white;
            width: 100%;
            font-size: 11px;
            padding: 5px;
        }

        .btn-buy {
            background-color: #2980b9;
            color: white;
        }

        .btn-pass {
            background-color: #95a5a6;
            color: white;
        }

        .btn-build {
            background-color: #e67e22;
            color: white;
            width: 100%;
            margin-top: 2px;
        }

        .btn-jail {
            background-color: #34495e;
            color: white;
        }

        .btn-chance {
            background-color: #9b59b6;
            color: white;
            width: 100%;
            padding: 5px;
        }

        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }

        /* å»ºè¨­ç”¨ãƒªã‚¹ãƒˆ */
        #build-menu {
            display: none;
            background: #fff;
            border: 1px solid #ccc;
            padding: 2px;
            border-radius: 2px;
            margin-top: 2px;
            width: 100%;
            box-sizing: border-box;
            max-height: 80px;
            overflow-y: auto;
        }

        .build-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2px;
            border-bottom: 1px solid #eee;
            font-size: 8px;
            cursor: pointer;
        }

        .build-item:hover {
            background-color: #f0f0f0;
        }

        #game-log {
            flex-grow: 1;
            background: #fafafa;
            border: 1px solid #ddd;
            border-radius: 2px;
            padding: 4px;
            overflow-y: auto;
            height: 90px;
            font-size: 8px;
            font-family: monospace;
        }

        .log-entry {
            margin-bottom: 1px;
            border-bottom: 1px dashed #eee;
            padding-bottom: 1px;
        }

        .log-p1 {
            color: #c0392b;
            font-weight: bold;
        }

        .log-p2 {
            color: #2980b9;
            font-weight: bold;
        }

        .log-chance {
            color: #8e44ad;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div id="game-container"> <!-- ãƒœãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
        <div id="board-wrapper">
            <div id="game-board"> <!-- ã‚»ãƒ³ã‚¿ãƒ¼ã‚¨ãƒªã‚¢ -->
                <div class="square-center">
                    <h1 style="font-size:12px; margin:0; color:#444; line-height:1;">PROPERTY<br>GAME</h1>
                    <p style="font-size:7px; color:#888; margin:1px 0;">Chance Added</p>
                    <div style="font-size:16px;">ğŸ˜ï¸</div>
                </div> <!-- JSã§ãƒã‚¹ã‚’ç”Ÿæˆ -->
            </div>
        </div> <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ -->
        <div id="control-panel"> <!-- P1 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
            <div id="p1-card" class="player-card p1 active"> <span id="p1-jail-badge" class="jail-badge">åˆ‘å‹™æ‰€</span>
                <div style="font-weight:bold; color:var(--p1-color); font-size:9px;">PLAYER 1 (èµ¤)</div>
                <div class="money-display" id="p1-money">$1500</div>
                <div style="font-size:8px;">æ‰€æœ‰: <span id="p1-props">0</span> / å®¶: <span id="p1-houses">0</span></div>
            </div> <!-- P2 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
            <div id="p2-card" class="player-card p2"> <span id="p2-jail-badge" class="jail-badge">åˆ‘å‹™æ‰€</span>
                <div style="font-weight:bold; color:var(--p2-color); font-size:9px;">PLAYER 2 (é’)</div>
                <div class="money-display" id="p2-money">$1500</div>
                <div style="font-size:8px;">æ‰€æœ‰: <span id="p2-props">0</span> / å®¶: <span id="p2-houses">0</span></div>
            </div> <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
            <div id="action-area">
                <p id="status-msg" style="font-size:9px; margin:2px 0;">Player 1 ã®ã‚¿ãƒ¼ãƒ³ã§ã™</p>
                <div id="buttons"> <!-- å‹•çš„ã«ãƒœã‚¿ãƒ³ç”Ÿæˆ --> </div>
                <div id="build-menu"></div>
            </div> <!-- ãƒ­ã‚° -->
            <div id="game-log"></div>
        </div>
    </div>
    <script> /* ========================================= 1. ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å®šç¾© ========================================= */ const boardData = [{ index: 0, name: "START", type: "special", price: 0, rent: 0, group: "none" }, { index: 1, name: "ä¸‹ç”ºA", type: "property", price: 60, rent: 2, group: "brown", houseCost: 50 }, { index: 2, name: "åŸºé‡‘", type: "chance", price: 0, rent: 0, group: "none" }, { index: 3, name: "ä¸‹ç”ºB", type: "property", price: 60, rent: 4, group: "brown", houseCost: 50 }, { index: 4, name: "æ‰€å¾—ç¨", type: "special", price: 0, rent: 0, group: "tax" }, { index: 5, name: "å—é‰„é“", type: "railroad", price: 200, rent: 25, group: "railroad" }, { index: 6, name: "ã‚µãƒ–ã‚«ãƒ«A", type: "property", price: 100, rent: 6, group: "lightblue", houseCost: 50 }, { index: 7, name: "ãƒãƒ£ãƒ³ã‚¹", type: "chance", price: 0, rent: 0, group: "none" },
        { index: 8, name: "ã‚µãƒ–ã‚«ãƒ«B", type: "property", price: 100, rent: 6, group: "lightblue", houseCost: 50 }, { index: 9, name: "ã‚µãƒ–ã‚«ãƒ«C", type: "property", price: 120, rent: 8, group: "lightblue", houseCost: 50 }, { index: 10, name: "åˆ‘å‹™æ‰€", type: "special", price: 0, rent: 0, group: "none" }, { index: 11, name: "å­¦ç”Ÿè¡—A", type: "property", price: 140, rent: 10, group: "pink", houseCost: 100 }, { index: 12, name: "é›»åŠ›", type: "utility", price: 150, rent: 0, group: "utility" }, { index: 13, name: "å­¦ç”Ÿè¡—B", type: "property", price: 140, rent: 10, group: "pink", houseCost: 100 }, { index: 14, name: "å­¦ç”Ÿè¡—C", type: "property", price: 160, rent: 12, group: "pink", houseCost: 100 }, { index: 15, name: "è¥¿é‰„é“", type: "railroad", price: 200, rent: 25, group: "railroad" }, { index: 16, name: "ç¹è¯è¡—A", type: "property", price: 180, rent: 14, group: "orange", houseCost: 100 }, { index: 17, name: "åŸºé‡‘", type: "chance", price: 0, rent: 0, group: "none" }, { index: 18, name: "ç¹è¯è¡—B", type: "property", price: 180, rent: 14, group: "orange", houseCost: 100 }, { index: 19, name: "ç¹è¯è¡—C", type: "property", price: 200, rent: 16, group: "orange", houseCost: 100 }, { index: 20, name: "é§è»Šå ´", type: "special", price: 0, rent: 0, group: "none" }, { index: 21, name: "ãƒ“ã‚¸ãƒã‚¹A", type: "property", price: 220, rent: 18, group: "red", houseCost: 150 }, { index: 22, name: "ãƒãƒ£ãƒ³ã‚¹", type: "chance", price: 0, rent: 0, group: "none" }, { index: 23, name: "ãƒ“ã‚¸ãƒã‚¹B", type: "property", price: 220, rent: 18, group: "red", houseCost: 150 }, { index: 24, name: "ãƒ“ã‚¸ãƒã‚¹C", type: "property", price: 240, rent: 20, group: "red", houseCost: 150 }, { index: 25, name: "åŒ—é‰„é“", type: "railroad", price: 200, rent: 25, group: "railroad" }, { index: 26, name: "é›»æ°—è¡—A", type: "property", price: 260, rent: 22, group: "yellow", houseCost: 150 }, { index: 27, name: "é›»æ°—è¡—B", type: "property", price: 260, rent: 22, group: "yellow", houseCost: 150 }, { index: 28, name: "æ°´é“", type: "utility", price: 150, rent: 0, group: "utility" }, { index: 29, name: "é›»æ°—è¡—C", type: "property", price: 280, rent: 24, group: "yellow", houseCost: 150 }, { index: 30, name: "é€®æ•", type: "special", price: 0, rent: 0, group: "none" }, { index: 31, name: "é«˜ç´šA", type: "property", price: 300, rent: 26, group: "green", houseCost: 200 }, { index: 32, name: "é«˜ç´šB", type: "property", price: 300, rent: 26, group: "green", houseCost: 200 }, { index: 33, name: "åŸºé‡‘", type: "chance", price: 0, rent: 0, group: "none" }, {
            index: 34, name: "é«˜ç´šC", type: "property", price: 320, rent: 28, group: "green",
            houseCost: 200
        }, { index: 35, name: "æ±é‰„é“", type: "railroad", price: 200, rent: 25, group: "railroad" }, { index: 36, name: "ãƒãƒ£ãƒ³ã‚¹", type: "chance", price: 0, rent: 0, group: "none" }, { index: 37, name: "ä¸€ç­‰åœ°A", type: "property", price: 350, rent: 35, group: "darkblue", houseCost: 200 }, { index: 38, name: "ç‰©å“ç¨", type: "special", price: 0, rent: 0, group: "tax" }, { index: 39, name: "ä¸€ç­‰åœ°B", type: "property", price: 400, rent: 50, group: "darkblue", houseCost: 200 }]; const groupColors = { brown: '#8d6e63', lightblue: '#81d4fa', pink: '#f48fb1', orange: '#ffcc80', red: '#ef5350', yellow: '#fff59d', green: '#a5d6a7', darkblue: '#64b5f6', railroad: '#bdbdbd', utility: '#cfd8dc', tax: '#9e9e9e', none: 'transparent' }; const groupCounts = {}; boardData.forEach(d => { if (d.group !== 'none' && d.group !== 'railroad' && d.group !== 'utility') { groupCounts[d.group] = (groupCounts[d.group] || 0) + 1; } }); /* --- ãƒãƒ£ãƒ³ã‚¹ã‚«ãƒ¼ãƒ‰å®šç¾© --- */ const chanceDeck = [{ text: "éŠ€è¡Œã‚ˆã‚Š$200å—å–ã‚‹", action: "money", value: 200 }, { text: "ã‚¹ãƒ”ãƒ¼ãƒ‰é•åã®ç½°é‡‘$15", action: "money", value: -15 }, { text: "ã‚¹ã‚¿ãƒ¼ãƒˆã¸æˆ»ã‚‹(å—å–$200)", action: "move", target: 0 }, { text: "åˆ‘å‹™æ‰€ã¸è¡Œã", action: "jail" }, { text: "3ãƒã‚¹æˆ»ã‚‹", action: "back", value: 3 }, { text: "å®¶ã®ä¿®ç†è²»$100æ”¯æ‰•ã†", action: "money", value: -100 }, { text: "èª•ç”Ÿæ—¥ï¼å„äººã‹ã‚‰$50è²°ã†", action: "collect", value: 50 }, { text: "å®ãã˜å½“é¸ï¼$100å—å–ã‚‹", action: "money", value: 100 }, { text: "ç‰©å“ç¨æ”¯æ‰•ã„$50", action: "money", value: -50 }, { text: "ãƒ•ãƒªãƒ¼ãƒ‘ãƒ¼ã‚­ãƒ³ã‚°ã¸ç§»å‹•", action: "move", target: 20 }]; /* ========================================= 2. ã‚²ãƒ¼ãƒ ã‚¯ãƒ©ã‚¹ (ãƒ­ã‚¸ãƒƒã‚¯çµ±æ‹¬) ========================================= */ class MonopolyGame {
            constructor() {
                this.turn = 1;
                this.players = { 1: { id: 1, name: "Player 1", pos: 0, money: 1500, properties: [], inJail: false, jailTurns: 0, el: null }, 2: { id: 2, name: "Player 2", pos: 0, money: 1500, properties: [], inJail: false, jailTurns: 0, el: null } }; this.gridState = {}; this.isAnimating = false;
            } init() { boardData.forEach(d => { this.gridState[d.index] = { owner: null, houses: 0 }; }); this.renderBoard(); this.createTokens(); this.updateUI(); this.setupTurnButtons(); this.log("ã‚²ãƒ¼ãƒ é–‹å§‹ï¼Player 1 ã®ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚"); } // --- æç”»é–¢é€£ --- 
            renderBoard() {
                const boardEl = document.getElementById('game-board'); boardData.forEach(data => {
                    const sq = document.createElement('div'); sq.className = 'square'; sq.id = `sq-${data.index}`; let r, c; if (data.index === 0) { r = 11; c = 11; } else if (data.index < 10) { r = 11; c = 11 - data.index; } else if (data.index === 10) { r = 11; c = 1; } else if (data.index < 20) { r = 11 - (data.index - 10); c = 1; } else if (data.index === 20) { r = 1; c = 1; } else if (data.index < 30) { r = 1; c = 1 + (data.index - 20); } else if (data.index === 30) { r = 1; c = 11; } else { r = 1 + (data.index - 30); c = 11; } sq.style.gridRow = r; sq.style.gridColumn = c; const bar = document.createElement('div');
                    bar.className = 'color-bar'; bar.style.backgroundColor = groupColors[data.group]; sq.appendChild(bar); const houseCont = document.createElement('div'); houseCont.className = 'house-container'; houseCont.id = `house-cont-${data.index}`; sq.appendChild(houseCont); const nameDiv = document.createElement('div'); nameDiv.className = 'square-name'; nameDiv.innerText = data.name; sq.appendChild(nameDiv); if (data.price > 0) { const priceDiv = document.createElement('div'); priceDiv.className = 'square-price'; priceDiv.innerText = `$${data.price}`; sq.appendChild(priceDiv); } const ownerInd = document.createElement('div'); ownerInd.className = 'owner-indicator'; ownerInd.id = `owner-ind-${data.index}`; sq.appendChild(ownerInd); boardEl.appendChild(sq);
                });
            } createTokens() { [1, 2].forEach(id => { const t = document.createElement('div'); t.className = `token p${id}`; document.getElementById('sq-0').appendChild(t); this.players[id].el = t; }); } setupTurnButtons() {
                const btnArea = document.getElementById('buttons'); const p = this.players[this.turn];
                document.getElementById('build-menu').style.display = 'none'; if (p.inJail) { let html = `<p style="font-size:9px; margin:2px;">ã€åˆ‘å‹™æ‰€ã€‘æ®‹ã‚Š${3 - p.jailTurns}ã‚¿ãƒ¼ãƒ³</p>`; html += `<button class="btn btn-roll" onclick="game.tryDiceJail()">ğŸ² ã‚¾ãƒ­ç›®ã‚’ç‹™ã†</button>`; if (p.money >= 50) { html += `<button class="btn btn-jail" onclick="game.payBail()">ğŸ’¸ ä¿é‡ˆé‡‘ã‚’æ‰•ã† ($50)</button>`; } btnArea.innerHTML = html; } else { btnArea.innerHTML = `<button id="btn-roll" class="btn btn-roll" onclick="game.rollDice()">ğŸ² ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹</button>`; if (this.canBuildAny(this.turn)) { btnArea.innerHTML += `<button class="btn btn-build" onclick="game.toggleBuildMenu()">ğŸ  å»ºè¨­ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã</button>`; } }
            } // --- åˆ‘å‹™æ‰€ãƒ­ã‚¸ãƒƒã‚¯ --- 
            payBail() { const p = this.players[this.turn]; p.money -= 50; p.inJail = false; p.jailTurns = 0; this.log(`P${this.turn} ã¯ä¿é‡ˆé‡‘ã‚’æ‰•ã£ã¦å‡ºæ‰€ã—ãŸã€‚`); this.updateUI(); this.setupTurnButtons(); } tryDiceJail() {
                const d1 = Math.floor(Math.random() * 6) + 1; const d2 = Math.floor(Math.random() * 6) + 1; const p = this.players[this.turn]; this.updateStatus(`ğŸ² ${d1}, ${d2} ...`); if (d1 === d2) {
                    this.log(`P${this.turn} ã‚¾ãƒ­ç›®ï¼é‡ˆæ”¾ã•ã‚Œã¦é€²ã¿ã¾ã™ã€‚`); p.inJail = false;
                    p.jailTurns = 0; this.movePlayer(this.turn, d1 + d2);
                } else { this.log(`P${this.turn} å¤±æ•—... (æ®‹ã‚Š${2 - p.jailTurns}å›)`); p.jailTurns++; if (p.jailTurns >= 3) { this.log(`P${this.turn} å¼·åˆ¶é‡ˆæ”¾ ($50æ”¯æ‰•ã„)`); p.money -= 50; p.inJail = false; p.jailTurns = 0; this.movePlayer(this.turn, d1 + d2); } else { this.showEndTurnButton(); } }
            } goToJail(playerId) { const p = this.players[playerId]; this.log(`P${playerId} ã¯åˆ‘å‹™æ‰€ã¸é€ã‚‰ã‚ŒãŸï¼`); p.pos = 10; p.inJail = true; p.jailTurns = 0; document.getElementById(`sq-10`).appendChild(p.el); this.updateUI(); this.showEndTurnButton(); } // --- ç§»å‹•ãƒ­ã‚¸ãƒƒã‚¯ --- 
            rollDice() { if (this.isAnimating) return; this.isAnimating = true; document.getElementById('buttons').innerHTML = `<p style="font-size:9px;">ç§»å‹•ä¸­...</p>`; document.getElementById('build-menu').style.display = 'none'; const d1 = Math.floor(Math.random() * 6) + 1; const d2 = Math.floor(Math.random() * 6) + 1; const total = d1 + d2; this.updateStatus(`ğŸ² ${d1} + ${d2} = ${total} ãƒã‚¹é€²ã¿ã¾ã™`); this.movePlayer(this.turn, total); }
            movePlayer(playerId, steps) { const p = this.players[playerId]; let stepsLeft = steps; const stepInterval = setInterval(() => { p.pos = (p.pos + 1) % 40; if (p.pos === 0) { p.money += 200; this.log(`P${playerId} ã‚¹ã‚¿ãƒ¼ãƒˆé€šé: +$200`); this.updateUI(); } document.getElementById(`sq-${p.pos}`).appendChild(p.el); stepsLeft--; if (stepsLeft <= 0) { clearInterval(stepInterval); this.handleSquareArrival(playerId); } }, 100); } handleSquareArrival(playerId) {
                this.isAnimating = false; const p = this.players[playerId]; const sq = boardData[p.pos]; this.updateStatus(`${sq.name} ã«åˆ°ç€ã—ã¾ã—ãŸã€‚`); if (p.pos === 30) { setTimeout(() => this.goToJail(playerId), 500); return; } if (sq.type === 'chance') { this.showChanceButton(); return; } if (['property', 'railroad', 'utility'].includes(sq.type)) {
                    const state = this.gridState[p.pos]; if (state.owner === null) {
                        if (p.money >= sq.price) {
                            this.showBuyOption(sq);
                        } else { this.log(`P${playerId}ã¯è³‡é‡‘ä¸è¶³ã§è³¼å…¥ä¸å¯ã€‚`); this.showEndTurnButton(); }
                    } else if (state.owner === playerId) { this.updateStatus("ã‚ãªãŸã®åœŸåœ°ã§ã™ã€‚"); this.showEndTurnButton(); } else { this.payRent(playerId, state.owner, sq); }
                } else if (sq.group === 'tax') { const tax = 200; p.money -= tax; this.log(`P${playerId} ã¯ç¨é‡‘ $${tax} ã‚’æ”¯æ‰•ã£ãŸã€‚`); this.updateUI(); this.showEndTurnButton(); } else { this.showEndTurnButton(); }
            } // --- ãƒãƒ£ãƒ³ã‚¹ã‚«ãƒ¼ãƒ‰å‡¦ç† --- 
            showChanceButton() { const btnArea = document.getElementById('buttons'); btnArea.innerHTML = `<button class="btn btn-chance" onclick="game.drawChanceCard()">ğŸ´ ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã</button>`; this.updateStatus("ãƒãƒ£ãƒ³ã‚¹ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã„ã¦ãã ã•ã„"); } drawChanceCard() {
                const p = this.players[this.turn]; // ãƒ©ãƒ³ãƒ€ãƒ ã«1æšé¸ã¶ 
                const card = chanceDeck[Math.floor(Math.random() * chanceDeck.length)]; this.log(`<span class="log-chance">ğŸ´ ${card.text}</span>`); this.updateStatus(`ã‚«ãƒ¼ãƒ‰: ${card.text}`); // åŠ¹æœå®Ÿè¡Œ 
                if (card.action === 'money') {
                    p.money += card.value; this.updateUI();
                    this.showEndTurnButton();
                } else if (card.action === 'move') {
                    p.pos = card.target; if (card.target === 0) p.money += 200; // ã‚¹ã‚¿ãƒ¼ãƒˆã¸ç§»å‹•æ™‚ã®ãƒœãƒ¼ãƒŠã‚¹(ã‚«ãƒ¼ãƒ‰ã«ã‚ˆã‚Šé‡è¤‡ã‚ã‚‹ãŒç°¡æ˜“å®Ÿè£…) 
                    document.getElementById(`sq-${p.pos}`).appendChild(p.el); // ç§»å‹•å…ˆã§ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ç°¡æ˜“åŒ–ã®ãŸã‚ç™ºç”Ÿã•ã›ãªã„ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰ 
                    this.updateUI(); this.showEndTurnButton();
                } else if (card.action === 'jail') { this.goToJail(this.turn); } else if (card.action === 'back') {
                    p.pos = (p.pos - card.value + 40) % 40; document.getElementById(`sq-${p.pos}`).appendChild(p.el); this.handleSquareArrival(this.turn); // æˆ»ã£ãŸå…ˆã§ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿã•ã›ã‚‹ 
                } else if (card.action === 'collect') { const opponentId = (this.turn === 1) ? 2 : 1; this.players[opponentId].money -= card.value; p.money += card.value; this.log(`P${opponentId} ã‹ã‚‰ $${card.value} å¾´åã—ãŸ`); this.updateUI(); this.showEndTurnButton(); }
            } // --- å»ºè¨­æ©Ÿèƒ½ --- 
            canBuildAny(playerId) { const p = this.players[playerId]; for (let group in groupCounts) { if (this.checkMonopoly(playerId, group)) { const props = boardData.filter(d => d.group === group); if (props.some(d => this.gridState[d.index].houses < 5)) { return true; } } } return false; } checkMonopoly(playerId, group) { const props = boardData.filter(d => d.group === group); return props.every(d => this.gridState[d.index].owner === playerId); }
            toggleBuildMenu() { const menu = document.getElementById('build-menu'); if (menu.style.display === 'block') { menu.style.display = 'none'; return; } let html = `<strong>å»ºè¨­å¯èƒ½ãªåœŸåœ° ($ã¯å»ºè¨­è²»)</strong><br>`; let hasItem = false; const p = this.players[this.turn]; for (let group in groupCounts) { if (this.checkMonopoly(this.turn, group)) { const props = boardData.filter(d => d.group === group); props.forEach(d => { const s = this.gridState[d.index]; if (s.houses < 5) { const cost = d.houseCost; const canAfford = p.money >= cost; const houseLabel = s.houses === 4 ? "ãƒ›ãƒ†ãƒ«ã¸æ”¹è£…" : `å®¶${s.houses + 1}è»’ç›®`; if (canAfford) { hasItem = true; html += `<div class="build-item" onclick="game.buildHouse(${d.index})"> <span style="color:${groupColors[group]}">â– </span> ${d.name} (${houseLabel}) <b>$${cost}</b> </div>`; } } }); } } if (!hasItem) html += `<div style="font-size:10px; color:#888;">å»ºè¨­ã§ãã‚‹åœŸåœ°ã¾ãŸã¯è³‡é‡‘ãŒã‚ã‚Šã¾ã›ã‚“</div>`; menu.innerHTML = html; menu.style.display = 'block'; } buildHouse(index) {
                const p = this.players[this.turn];
                const d = boardData[index]; const s = this.gridState[index]; p.money -= d.houseCost; s.houses++; let type = s.houses === 5 ? "ãƒ›ãƒ†ãƒ«" : "å®¶"; this.log(`P${this.turn} ã¯ ${d.name} ã«${type}ã‚’å»ºã¦ãŸ (-$${d.houseCost})`); this.updateUI(); this.renderHouse(index); this.toggleBuildMenu();
            } renderHouse(index) { const cont = document.getElementById(`house-cont-${index}`); const s = this.gridState[index]; cont.innerHTML = ''; if (s.houses === 5) { const h = document.createElement('div'); h.className = 'house-icon hotel'; cont.appendChild(h); } else { for (let i = 0; i < s.houses; i++) { const h = document.createElement('div'); h.className = 'house-icon'; cont.appendChild(h); } } } // --- å®¶è³ƒè¨ˆç®— --- 
            payRent(debtorId, ownerId, sq) {
                const s = this.gridState[sq.index]; let rent = sq.rent; let multiplier = 1; if (['property'].includes(sq.type)) {
                    if (s.houses > 0) { multiplier = 1 + (s.houses * 5); } else if (this.checkMonopoly(ownerId, sq.group)) {
                        multiplier = 2; this.log("ç‹¬å ãƒœãƒ¼ãƒŠã‚¹ã§å®¶è³ƒ2å€ï¼");
                    }
                } let finalRent = rent * multiplier; this.players[debtorId].money -= finalRent; this.players[ownerId].money += finalRent; this.log(`P${debtorId} ã¯ P${ownerId} ã«å®¶è³ƒ $${finalRent} æ”¯æ‰•ã£ãŸ`); this.updateUI(); this.showEndTurnButton();
            } // --- ã‚¿ãƒ¼ãƒ³ç®¡ç† --- 
            showBuyOption(sq) { const btnArea = document.getElementById('buttons'); btnArea.innerHTML = ` <button class="btn btn-buy" onclick="game.buyProperty()">è²·ã† ($${sq.price})</button> <button class="btn btn-pass" onclick="game.passTurn()">è²·ã‚ãªã„</button> `; this.updateStatus(`${sq.name} ã‚’è³¼å…¥ã—ã¾ã™ã‹ï¼Ÿ`); } buyProperty() { const p = this.players[this.turn]; const sq = boardData[p.pos]; p.money -= sq.price; p.properties.push(p.pos); this.gridState[p.pos].owner = this.turn; const indicator = document.getElementById(`owner-ind-${p.pos}`); indicator.style.backgroundColor = (this.turn === 1) ? 'var(--p1-color)' : 'var(--p2-color)'; this.log(`P${this.turn} ãŒ ${sq.name} ã‚’è³¼å…¥ã—ã¾ã—ãŸã€‚`); this.updateUI(); this.showEndTurnButton(); } passTurn() {
                this.log(`P${this.turn} ã¯è³¼å…¥ã‚’è¦‹é€ã‚Šã¾ã—ãŸã€‚`); this.showEndTurnButton();
            } showEndTurnButton() { const btnArea = document.getElementById('buttons'); let html = `<button class="btn btn-roll" onclick="game.nextTurnTrigger()">æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¸</button>`; if (this.canBuildAny(this.turn)) { html += `<button class="btn btn-build" onclick="game.toggleBuildMenu()">ğŸ  å»ºè¨­ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã</button>`; } btnArea.innerHTML = html; } nextTurnTrigger() { this.turn = (this.turn === 1) ? 2 : 1; this.updateStatus(`Player ${this.turn} ã®ã‚¿ãƒ¼ãƒ³ã§ã™`); document.getElementById('p1-card').classList.toggle('active'); document.getElementById('p2-card').classList.toggle('active'); this.setupTurnButtons(); } /* --- UIæ›´æ–° --- */ updateUI() { for (let id of [1, 2]) { const p = this.players[id]; document.getElementById(`p${id}-money`).innerText = `$${p.money}`; document.getElementById(`p${id}-props`).innerText = p.properties.length; let totalHouses = 0; p.properties.forEach(idx => totalHouses += this.gridState[idx].houses); document.getElementById(`p${id}-houses`).innerText = totalHouses; document.getElementById(`p${id}-money`).style.color = (p.money < 0) ? 'red' : 'inherit'; document.getElementById(`p${id}-jail-badge`).style.display = p.inJail ? 'block' : 'none'; } } updateStatus(msg) {
                document.getElementById('status-msg').innerText = msg;
            } log(msg) { const logEl = document.getElementById('game-log'); const entry = document.createElement('div'); entry.className = 'log-entry'; let formattedMsg = msg.replace('P1', '<span class="log-p1">P1</span>').replace('P2', '<span class="log-p2">P2</span>'); entry.innerHTML = formattedMsg; logEl.prepend(entry); }
        } const game = new MonopolyGame(); window.onload = () => game.init(); </script>
</body>

</html>